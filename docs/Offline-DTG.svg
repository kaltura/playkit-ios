<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="374px" preserveAspectRatio="none" style="width:757px;height:374px;" version="1.1" viewBox="0 0 757 374" width="757px" zoomAndPan="magnify"><defs><filter height="300%" id="f930hkvbfqkip" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke: #A80036; stroke-width: 1.0;" x1="31" x2="31" y1="38.4883" y2="165.7305"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="31" x2="31" y1="165.7305" y2="206.6855"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="31" x2="31" y1="206.6855" y2="333.9277"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="528.5" x2="528.5" y1="38.4883" y2="165.7305"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="528.5" x2="528.5" y1="165.7305" y2="206.6855"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="528.5" x2="528.5" y1="206.6855" y2="333.9277"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="683.5" x2="683.5" y1="38.4883" y2="165.7305"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="683.5" x2="683.5" y1="165.7305" y2="206.6855"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="683.5" x2="683.5" y1="206.6855" y2="333.9277"/><rect fill="#FEFECE" filter="url(#f930hkvbfqkip)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="42" x="8" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="28" x="15" y="23.5352">App</text><rect fill="#FEFECE" filter="url(#f930hkvbfqkip)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="42" x="8" y="332.9277"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="28" x="15" y="353.4629">App</text><rect fill="#FEFECE" filter="url(#f930hkvbfqkip)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="153" x="450.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="139" x="457.5" y="23.5352">LocalAssetsManager</text><rect fill="#FEFECE" filter="url(#f930hkvbfqkip)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="153" x="450.5" y="332.9277"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="139" x="457.5" y="353.4629">LocalAssetsManager</text><rect fill="#FEFECE" filter="url(#f930hkvbfqkip)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="129" x="617.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="115" x="624.5" y="23.5352">ContentManager</text><rect fill="#FEFECE" filter="url(#f930hkvbfqkip)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="129" x="617.5" y="332.9277"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="115" x="624.5" y="353.4629">ContentManager</text><polygon fill="#A80036" points="517,65.4883,527,69.4883,517,73.4883,521,69.4883" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="31" x2="523" y1="69.4883" y2="69.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="408" x="38" y="65.0566">mediaSource = getPreferredDownloadableMediaSource(for: entry)</text><polygon fill="#A80036" points="672,94.7988,682,98.7988,672,102.7988,676,98.7988" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="31" x2="678" y1="98.7988" y2="98.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="310" x="38" y="94.3672">addItem(id: entry.id, url: mediaSource.contentUrl)</text><polygon fill="#A80036" points="672,124.1094,682,128.1094,672,132.1094,676,128.1094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="31" x2="678" y1="128.1094" y2="128.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="384" x="38" y="123.6777">loadItemMetadata(id: entry.id, preferredVideoBitrate: 300000)</text><polygon fill="#A80036" points="672,153.4199,682,157.4199,672,161.4199,676,157.4199" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="31" x2="678" y1="157.4199" y2="157.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="38" y="152.9883">startItem(id: entry.id)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="70" x="322.5" y="190.3652">Downloading</text><polygon fill="#A80036" points="42,223.6855,32,227.6855,42,231.6855,38,227.6855" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="36" x2="683" y1="227.6855" y2="227.6855"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="48" y="223.2539">finished</text><polygon fill="#A80036" points="672,252.9961,682,256.9961,672,260.9961,676,256.9961" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="31" x2="678" y1="256.9961" y2="256.9961"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="269" x="38" y="252.5645">playbackUrl = itemPlaybackUrl(id: entry.id)</text><polygon fill="#A80036" points="517,282.3066,527,286.3066,517,290.3066,521,286.3066" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="31" x2="523" y1="286.3066" y2="286.3066"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="474" x="38" y="281.875">registerDownloadedAsset(location:playbackUrl, mediaSource: mediaSource)</text><polygon fill="#A80036" points="42,311.6172,32,315.6172,42,319.6172,38,315.6172" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="36" x2="528" y1="315.6172" y2="315.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="31" x="48" y="311.1855">done</text><!--
@startuml Offline-DTG

participant App
participant LocalAssetsManager as LAM
participant ContentManager as CM

App->LAM: mediaSource = getPreferredDownloadableMediaSource(for: entry)

App->CM: addItem(id: entry.id, url: mediaSource.contentUrl)
App->CM: loadItemMetadata(id: entry.id, preferredVideoBitrate: 300000)
App->CM: startItem(id: entry.id)

... Downloading ...

CM- ->App: finished
App->CM: playbackUrl = itemPlaybackUrl(id: entry.id)
App->LAM: registerDownloadedAsset(location:playbackUrl, mediaSource: mediaSource)
LAM- ->App: done

@enduml

PlantUML version 1.2018.02beta8(Unknown compile time)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_152-release-915-b08
Operating System: Mac OS X
OS Version: 10.13.3
Default Encoding: UTF-8
Language: en
Country: IL
--></g></svg>